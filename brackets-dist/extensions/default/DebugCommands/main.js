define("ErrorNotification",["require","exports","module"],function(e,t,n){function a(){try{brackets.app.showDeveloperTools()}catch(e){console.error(e)}}function r(e){e.shiftKey?window.console.clear():a()}function o(){return E&&0!==w?v?void v.text(w).parent().show():(v=$("<span>").text(w),void $("<div>").attr("id","error-counter").attr("title",b.CMD_SHOW_DEV_TOOLS+"…").text(b.ERRORS+": ").append(v).on("click",r).insertBefore("#status-bar .spinner")):void(v&&v.parent().hide())}function i(){w++,M(),o()}function s(){w=0,o()}function l(){E||(E=!0,c=window.onerror,g=window.console.error,f=window.console.clear,window.onerror=function(e,t,n){return i(),c?c(e,t,n):!1},window.console.error=function(){return i(),g.apply(window.console,arguments)},window.console.clear=function(){return s(),f.apply(window.console,arguments)})}function d(){E&&(E=!1,window.onerror=c,window.console.error=g,window.console.clear=f)}function u(e){e?l():d(),o()}var c,g,f,p=brackets.getModule("thirdparty/lodash"),m=brackets.getModule("utils/AnimationUtils"),h=brackets.getModule("utils/ExtensionUtils"),b=brackets.getModule("strings"),v=null,w=0,E=!1;h.loadStyleSheet(n,"styles.css");var M=p.debounce(function(){m.animateUsingClass(v.parent()[0],"flash",1500)},100);t.toggle=u}),define("NodeDebugUtils",["require","exports","module"],function(e,t){function n(){brackets.app&&brackets.app.getNodeState?brackets.app.getNodeState(function(e,t){console.log(e?"[NodeDebugUtils] Node is in error state "+e:"[NodeDebugUtils] Node is listening on port "+t)}):console.error("[NodeDebugUtils] No brackets.app.getNodeState function. Maybe you're running the wrong shell?")}function a(){try{s.domains.base.restartNode()}catch(e){alert("Failed trying to restart Node: "+e.message)}}function r(){try{s.domains.base.enableDebugger()}catch(e){alert("Failed trying to enable Node debugger: "+e.message)}}function o(e,t,n,a){var r=new Date(n);l.push({level:t,timestamp:r,message:a});var o="[node-"+t+" "+r.toLocaleTimeString()+"] "+a;switch(t){case"info":case"warn":case"error":console[t](o);break;default:console.log(o)}}var i=brackets.getModule("utils/NodeConnection"),s=null,l=[];s=new i,s.connect(!0),s.on("base:log",o),t.logNodeState=n,t.restartNode=a,t.enableDebugger=r}),define("text",["module"],function(e){var t,n,a,r,o,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,u=d&&location.protocol&&location.protocol.replace(/\:/,""),c=d&&location.hostname,g=d&&(location.port||void 0),f={},p=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(a){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,a,r=!1,o=e.indexOf("."),i=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!i||o>1)?(t=e.substring(0,o),n=e.substring(o+1,e.length)):t=e,a=n||t,o=a.indexOf("!"),-1!==o&&(r="strip"===a.substring(o+1),a=a.substring(0,o),n?n=a:t=a),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,a,r){var o,i,s,l=t.xdRegExp.exec(e);return l?(o=l[2],i=l[3],i=i.split(":"),s=i[1],i=i[0],!(o&&o!==n||i&&i.toLowerCase()!==a.toLowerCase()||(s||i)&&s!==r)):!0},finishLoad:function(e,n,a,r){a=n?t.strip(a):a,p.isBuild&&(f[e]=a),r(a)},load:function(e,n,a,r){if(r.isBuild&&!r.inlineText)return void a();p.isBuild=r.isBuild;var o=t.parseName(e),i=o.moduleName+(o.ext?"."+o.ext:""),s=n.toUrl(i),l=p.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void a():void(!d||l(s,u,c,g)?t.get(s,function(n){t.finishLoad(e,o.strip,n,a)},function(e){a.error&&a.error(e)}):n([i],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,a)}))},write:function(e,n,a){if(f.hasOwnProperty(n)){var r=t.jsEscape(f[n]);a.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,a,r,o){var i=t.parseName(n),s=i.ext?"."+i.ext:"",l=i.moduleName+s,d=a.toUrl(i.moduleName+s)+".js";t.load(l,a,function(){var n=function(e){return r(d,e)};n.asModule=function(e,t){return r.asModule(e,d,t)},t.write(e,l,n,o)},o)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,a){try{var r=n.readFileSync(e,"utf8");0===r.indexOf("﻿")&&(r=r.substring(1)),t(r)}catch(o){a(o)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,n,a,r){var o,i=t.createXhr();if(i.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&i.setRequestHeader(o.toLowerCase(),r[o]);p.onXhr&&p.onXhr(i,e),i.onreadystatechange=function(){var t,r;4===i.readyState&&(t=i.status,t>399&&600>t?(r=new Error(e+" HTTP status: "+t),r.xhr=i,a(r)):n(i.responseText),p.onXhrComplete&&p.onXhrComplete(i,e))},i.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,a,r="utf-8",o=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),l="";try{for(n=new java.lang.StringBuffer,a=s.readLine(),a&&a.length()&&65279===a.charAt(0)&&(a=a.substring(1)),null!==a&&n.append(a);null!==(a=s.readLine());)n.append(i),n.append(a);l=String(n.toString())}finally{s.close()}t(l)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(a=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in a,t.get=function(e,t){var n,i,s,l={};o&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{n=a["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),n.init(s,1,0,!1),i=a["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),i.init(n,"utf-8",n.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),l),i.close(),n.close(),t(l.value)}catch(d){throw new Error((s&&s.path||"")+": "+d)}}),t}),define("text!htmlContent/perf-dialog.html",[],function(){return'<div class="modal">\n    <div class="modal-header">\n        <h1 class="dialog-title">Performance Data</h1>\n    </div>\n    <div class="modal-body no-padding">\n        <table class="table table-striped">\n            <thead><th>Operation</th><th class="right">Time (ms)</th></thead>\n            <tbody>\n                {{#perfData}}\n                <tr>\n                    <td>{{{testName}}}</td>\n                    <td class="right">{{value}}</td>\n                </tr>\n                {{/perfData}}\n            </tbody>\n        </table>\n    </div>\n    <div class="modal-footer">\n        <div class="left">\n            <label for="brackets-perf-raw-data" class="inline">Raw data (copy paste out):</label>\n            <textarea rows="1" id="brackets-perf-raw-data" style="margin: 0; width: 50px;">{{delimitedPerfData}}</textarea>        \n        </div>\n        <button class="dialog-button btn primary" data-button-id="ok">Close</button>\n    </div>\n</div>\n'}),define("text!htmlContent/language-dialog.html",[],function(){return'<div class="switch-language modal">\n    <div class="modal-header">\n        <h1 class="dialog-title">{{Strings.LANGUAGE_TITLE}}</h1>\n    </div>\n    <div class="modal-body">\n        <p class="dialog-message">\n            {{Strings.LANGUAGE_MESSAGE}}\n            <select>\n                {{#languages}}\n                <option value="{{language}}">{{label}}</option>\n                {{/languages}}\n            </select>\n        </p>\n    </div>\n    <div class="modal-footer">\n        <button class="dialog-button btn primary" data-button-id="ok" disabled>{{Strings.LANGUAGE_SUBMIT}}</button>\n        <button class="dialog-button btn left" data-button-id="cancel">{{Strings.CANCEL}}</button>\n    </div>\n</div>\n'}),define("text!keyboard.json",[],function(){return'{\n    "showDeveloperTools":  [\n        {\n            "key": "F12"\n        },\n        {\n            "key": "Cmd-Opt-I",\n            "platform": "mac"\n        }\n    ],\n    "refreshWindow":  [\n        {\n            "key": "F5"\n        },\n        {\n            "key": "Cmd-R",\n            "platform": "mac"\n        }\n    ],\n    "reloadWithoutUserExts":  [\n        {\n            "key": "Shift-F5"\n        },\n        {\n            "key": "Cmd-Ctrl-R",\n            "platform": "mac"\n        }\n    ]\n}'}),define("main",["require","exports","module","ErrorNotification","NodeDebugUtils","text!htmlContent/perf-dialog.html","text!htmlContent/language-dialog.html","text!keyboard.json"],function(e,t){function n(){brackets.app.showDeveloperTools()}function a(e){var t=e?"?spec="+e:"";G&&!G.closed?G.location.search!==t?G.location.href="../test/SpecRunner.html"+t:G.location.reload(!0):(G=window.open("../test/SpecRunner.html"+t,"brackets-test","width="+$(window).width()+",height="+$(window).height()),G.location.reload(!0))}function r(){p.execute(f.APP_RELOAD)}function o(){p.execute(f.APP_RELOAD_WITHOUT_EXTS)}function i(){window.open(window.location.href)}function s(){var e={delimitedPerfData:v.getDelimitedPerfData(),perfData:[]},t=function(e){if(Array.isArray(e)){var t,n,a,r=0,o=Number.MAX_VALUE,i=0;for(t=0;t<e.length;t++)n=e[t],o=Math.min(o,n),r+=n,i=Math.max(i,n);return a=Math.round(10*r/e.length)/10,String(o)+"/"+String(a)+"("+e.length+")/"+String(i)+"/"+String(n)}return e},n=v.getData();g.forEach(n,function(n,a){e.perfData.push({testName:w.breakableUrl(a),value:t(n)})});var a=Mustache.render(_,e);E.showModalDialogUsingTemplate(a),$("#brackets-perf-raw-data").click(function(){$(this).focus().select()})}function l(){var e=b.getNativeBracketsDirectoryPath()+"/nls";h.getDirectoryForPath(e).getContents(function(e,t){if(!e){var n,a,r,o,i=brackets.isLocaleDefault()?null:brackets.getLocale(),s=[],l=function(){o=r.val(),a.prop("disabled",o===(i||""))};t.forEach(function(e){if(e.isDirectory){var t=e.name.match(/^([a-z]{2})(-[a-z]{2})?$/);if(t){var n=e.name,a=t[1];t[2]&&(a+=t[2].toUpperCase()),s.push({label:S.getLocalizedLabel(a),language:n})}}}),s.push({label:S.getLocalizedLabel("en"),language:"en"}),s.sort(function(e,t){return e.label.localeCompare(t.label)}),s.unshift({label:M.LANGUAGE_SYSTEM_DEFAULT,language:null});var d=Mustache.render(k,{languages:s,Strings:M});E.showModalDialogUsingTemplate(d).done(function(e){e===E.DIALOG_BTN_OK&&o!==i&&(brackets.setLocale(o),p.execute(f.APP_RELOAD))}),n=$(".switch-language.instance"),a=n.find(".dialog-button[data-button-id='"+E.DIALOG_BTN_OK+"']"),r=n.find("select"),r.on("change",l).val(i)}})}function d(){if(!brackets.inBrowser){var e=h.getFileForPath(b.getNativeBracketsDirectoryPath()+"/../test/SpecRunner.html");e.exists(function(e,t){!e&&t&&p.get(U).setEnabled(!0)})}}function u(e){var t,n=!!D.get(X);t=void 0===e?!n:!!e,N.toggle(t),p.get(X).setChecked(t),t!==n&&D.set(X,t)}function c(){var e=b.getNativeBracketsDirectoryPath().replace(/\/[^\/]+$/,"/");brackets.app.showOSFolder(e)}var g=brackets.getModule("thirdparty/lodash"),f=brackets.getModule("command/Commands"),p=brackets.getModule("command/CommandManager"),m=brackets.getModule("command/Menus"),h=brackets.getModule("filesystem/FileSystem"),b=brackets.getModule("file/FileUtils"),v=brackets.getModule("utils/PerfUtils"),w=brackets.getModule("utils/StringUtils"),E=brackets.getModule("widgets/Dialogs"),M=brackets.getModule("strings"),D=brackets.getModule("preferences/PreferencesManager"),S=brackets.getModule("utils/LocalizationUtils"),N=e("ErrorNotification"),y=e("NodeDebugUtils"),_=e("text!htmlContent/perf-dialog.html"),k=e("text!htmlContent/language-dialog.html"),C=JSON.parse(e("text!keyboard.json")),x="debug-menu",T="debug.refreshWindow",L="debug.showDeveloperTools",U="debug.runUnitTests",A="debug.showPerfData",O="debug.reloadWithoutUserExts",R="debug.newBracketsWindow",I="debug.switchLanguage",P="debug.enableNodeDebugger",F="debug.logNodeState",B="debug.restartNode",X="debug.showErrorsInStatusBar",W="debug.openBracketsSource";D.definePreference(X,"boolean",!1);var G=null;p.register(M.CMD_SHOW_DEV_TOOLS,L,n).setEnabled(!!brackets.app.showDeveloperTools),p.register(M.CMD_REFRESH_WINDOW,T,r),p.register(M.CMD_RELOAD_WITHOUT_USER_EXTS,O,o),p.register(M.CMD_NEW_BRACKETS_WINDOW,R,i),p.register(M.CMD_RUN_UNIT_TESTS,U,a).setEnabled(!1),p.register(M.CMD_SHOW_PERF_DATA,A,s),p.register(M.CMD_OPEN_BRACKETS_SOURCE,W,c).setEnabled(!w.endsWith(decodeURI(window.location.pathname),"/www/index.html")),p.register(M.CMD_SWITCH_LANGUAGE,I,l),p.register(M.CMD_SHOW_ERRORS_IN_STATUS_BAR,X,u),p.register(M.CMD_ENABLE_NODE_DEBUGGER,P,y.enableDebugger),p.register(M.CMD_LOG_NODE_STATE,F,y.logNodeState),p.register(M.CMD_RESTART_NODE,B,y.restartNode),d(),u(D.get(X)),D.on("change",X,function(){u(D.get(X))});var H=m.addMenu(M.DEBUG_MENU,x,m.BEFORE,m.AppMenuBar.HELP_MENU);H.addMenuItem(L,C.showDeveloperTools),H.addMenuItem(T,C.refreshWindow),H.addMenuItem(O,C.reloadWithoutUserExts),H.addMenuItem(R),H.addMenuDivider(),H.addMenuItem(I),H.addMenuDivider(),H.addMenuItem(U),H.addMenuItem(A),H.addMenuItem(W),H.addMenuDivider(),H.addMenuItem(P),H.addMenuItem(F),H.addMenuItem(B),H.addMenuItem(X),H.addMenuItem(f.FILE_OPEN_PREFERENCES),H.addMenuItem(f.FILE_OPEN_KEYMAP),t._runUnitTests=a});